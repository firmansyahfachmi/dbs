function getResponse(e) {
  var baseUrlCms = $("#baseUrlCms").val()
  var rankNum = 1
  var t
  switch (e) {
    case "all":
      e = "/backend/api/user/getScore"
      break
    case "week":
      e = "/backend/api/user/getScore/week"
      break
    case "month":
      e = "/backend/api/user/getScore/month"
  }
  return (
    e
      ? $.ajax({
          type: "POST",
          url: baseUrlCms + e,
          async: !1,
          crossDomain: !0,
        })
          .success(function (e) {
            if (e.path == "all") {
              if (e.data.length > 0) {
                rankNum = 1
                $(".board-body .winner-list").html("")
                $.each(e.data, function (idx, item) {
                  $(".board-body .winner-list").append(
                    '<div class="list-row"><div class="list-cell">' +
                      zeroPad(rankNum++, 2) +
                      '</div><div class="list-cell">' +
                      item.name +
                      '</div><div class="list-cell">' +
                      item.total_score +
                      "</div></div>"
                  )
                })
              } else {
                $(".board-body .winner-list").html(
                  '<div class="list-row"><div class="list-cell">00</div><div class="list-cell">-</div><div class="list-cell">-</div></div>'
                )
              }
            } else if (e.path == "week") {
              if (e.data.length > 0) {
                rankNum = 1
                $(".board-body .winner-list").html("")
                $.each(e.data, function (idx, item) {
                  $(".board-body .winner-list").append(
                    '<div class="list-row"><div class="list-cell">' +
                      zeroPad(rankNum++, 2) +
                      '</div><div class="list-cell">' +
                      item.name +
                      '</div><div class="list-cell">' +
                      item.total_score +
                      "</div></div>"
                  )
                })
              } else {
                $(".board-body .winner-list").html(
                  '<div class="list-row"><div class="list-cell">00</div><div class="list-cell">-</div><div class="list-cell">-</div></div>'
                )
              }
            } else if (e.path == "month") {
              if (e.data.length > 0) {
                rankNum = 1
                $(".board-body .winner-list").html("")
                $.each(e.data, function (idx, item) {
                  console.log("m")
                  $(".board-body .winner-list").append(
                    '<div class="list-row"><div class="list-cell">' +
                      zeroPad(rankNum++, 2) +
                      '</div><div class="list-cell">' +
                      item.name +
                      '</div><div class="list-cell">' +
                      item.total_score +
                      "</div></div>"
                  )
                })
              } else {
                $(".board-body .winner-list").html(
                  '<div class="list-row"><div class="list-cell">00</div><div class="list-cell">-</div><div class="list-cell">-</div></div>'
                )
              }
            }
            $("#loader").hide()
          })
          .fail(function (e, n, i) {
            var o = n + ", " + i
            console.log("Request Failed: " + o), (t = !1)
          })
      : (console.log("Unknown Request!"), (t = !1)),
    t
  )
}

function zeroPad(e, t) {
  var n = t - e.toString().length + 1
  return Array(+(n > 0 && n)).join("0") + e
}
function resetPopup() {
  $(".popup-wrapper").removeClass("in")
}
function visitRefuge() {
  _refuge ||
    ((_refuge = 1),
    inputPopupRe(
      "REST AREA",
      "",
      '<img src="assets/images/refugee.jpg" alt="" class="img-refugee">'
    ))
}
function inputPopup(e, t, n) {
  var i = $(".popup-global"),
    o = i.find(".popup-title h3"),
    s = i.find(".noted span"),
    r = i.find(".body-content")
  i.parent().addClass("in"), o.html(e), s.html(t), r.html(n)
}
function inputPopupRe(e, t, n) {
  var i = $(".popup-global-re"),
    o = i.find(".popup-title h3"),
    s = i.find(".noted span"),
    r = i.find(".body-content")
  i.parent().addClass("in"), o.html(e), s.html(t), r.html(n)
}
function inputPopupQuestion(e, t, n) {
  var i = $(".popup-global-q"),
    o = i.find(".popup-title h3"),
    s = i.find(".noted span"),
    r = i.find(".body-content")
  i.parent().addClass("in"), o.html(e), s.html(t), r.html(n)
}
function showPopup() {
  var e = $(".popup-global")
  resetPopup(), e.parent().addClass("in")
}

function closePopup(e) {
  $.alarm("stop")
  $(".popup-global").attr(
    "style",
    "max-width:100%;height:auto;bottom:30px;top:30px;"
  )
  var t = $(e).parents(".popup-wrapper"),
    n = t.find(".popup-title h3"),
    i = t.find(".noted span"),
    o = t.find(".body-content")
  currAlarm && $.alarm("stop"),
    t.removeClass("in"),
    n.html(""),
    i.html(""),
    o.html("")
}
function showMenu() {
  var e = $(".popup-menu")
  resetPopup(), e.parent().addClass("in")
}
function closeMenu() {
  var e = $(".popup-menu")
  e.parent().removeClass("in")
}
function showRefugeMsg(e) {
  var t = $(".popup-re")
  resetPopup(), t.find(".popup-close").attr("id", e), t.parent().addClass("in")
}
function closeRefugeMsg(e) {
  var t = $(".popup-re")
  t.parent().removeClass("in"),
    krpano.call("loadscene(" + $(e).attr("id") + ", null, MERGE);")
}
function showIntro() {
  var e = $(".popup-intro")
  resetPopup(), e.parent().addClass("in")
}
function closeIntro() {
  var e = $(".popup-intro")
  e.parent().removeClass("in")
}
function showHelp() {
  var e = $(".popup-help")
  e.parent().addClass("in")
}
function closeHelp() {
  var e = $(".popup-help")
  e.parent().removeClass("in")
}
function triggerPin(e) {
  $(".popup-global-q .popup-body-q .body-content").attr(
    "style",
    "width:100%;margin:0px 0 0 0;text-align:center;"
  )
  $(".popup-global-q").attr(
    "style",
    "max-width:600px;height:auto;bottom:auto;top:30px;"
  )
  $(".popup-global-q .popup-body-q").attr("style", "min-height:300px;")
  pilihData(e)
}
$(document).ready(function () {
  $(".body-quisioner").on("click", ".btn_true", function (e) {
    e.preventDefault()
    var data_id = $(this).attr("data-id")
    saveTime()
    sendAnswer(true, data_id)
  })
  $(".body-quisioner").on("click", ".btn_false", function (e) {
    e.preventDefault()
    var data_id = $(this).attr("data-id")
    saveTime()
    sendAnswer(false, data_id)
  })
})
function sendAnswer(jawaban, data_id) {
  var baseUrlCms = $("#baseUrlCms").val()
  var info_time = $(".info-time").text()
  $(".popup-global-q .popup-close").trigger("click")
  var session_id = localStorage.getItem("session_id")
  $.ajax({
    dataType: "json",
    url: baseUrlCms + "/backend/api/user/sendAnswer",
    data:
      "data_id=" +
      data_id +
      "&info_time=" +
      info_time +
      "&session_id=" +
      session_id +
      "&jawaban=" +
      jawaban,
    type: "POST",
    success: function (data) {
      // closePopup(this);
      TotaltriggerPin()
    },
  })
}

var savedTime = ""
var bonusPoint = 0

function saveTime() {
  savedTime = $(".info-time").text()
  let splitted = savedTime.split(" : ")
  bonusPoint = parseInt(splitted[1])
}
function pilihData(e) {
  var baseUrlCms = $("#baseUrlCms").val()
  var session_ids =
    localStorage.getItem("session_id") != null
      ? localStorage.getItem("session_id")
      : ""
  $.ajax({
    dataType: "json",
    url: baseUrlCms + "/backend/api/user/getQuiz?location=ciputra",
    data: "session_ids=" + session_ids + "&data_id=" + e,
    type: "POST",
    success: function (data) {
      // showPopup()
      var session_id = localStorage.getItem("session_id")
      if (session_id == "" || session_id == null) {
        localStorage.setItem("session_id", data.token)
      }
      let htmlData = ""
      if (data.quis != "" && data.quis != null) {
        var btnAktif1 = data.aktif == 1 ? "btn_active" : ""
        var btnAktif2 = data.aktif == 2 ? "btn_active" : ""
        htmlData += '<div class="questionnaire-cls" style="text-align:center;">'
        htmlData += '<h3 style="text-align:center;">' + data.quis + "</h3>"
        if (data.aktif != 1 && data.aktif != 2) {
          htmlData +=
            '<br><br><a href="#" data-id="' +
            data.id +
            '" class="' +
            btnAktif1 +
            ' btn_true btn btn-red font-size-18">True</a>' +
            '<a data-id="' +
            data.id +
            '" href="#" style="background:#ededed;" class="' +
            btnAktif2 +
            ' btn_false btn btn-default font-size-18">False</a>'
        }
        htmlData += "</div>"
      } else {
        htmlData += "<div>"
        htmlData +=
          '<h3 style="text-align:center;">There is no questionnaire yet</h3>'
        htmlData += ""
        htmlData += "</div>"
      }
      $(".popup-global-q .popup-body-q .body-quisioner").html(htmlData)
      inputPopupQuestion("questionnaire", "", "")
    },
  })
}
function TotaltriggerPin() {
  var baseUrlCms = $("#baseUrlCms").val()
  var session_ids =
    localStorage.getItem("session_id") != null
      ? localStorage.getItem("session_id")
      : ""
  $.ajax({
    dataType: "json",
    url: baseUrlCms + "/backend/api/user/userPointTotal",
    data: "session_id=" + session_ids,
    type: "POST",
    success: function (data) {
      var point = $("#poin span").text()
      $("#poin span").text(parseInt(data.data))
    },
  })

  // $('.popup-global .popup-body .body-content').html(e)
  // showPopup()
}
function startGame() {
  closeIntro(),
    closeHelp(),
    inputPopup(
      "LET'S TEST YOUR KNOWLEDGE",
      "BEGIN",
      '<div><h5>Do you know how to escape?</h5><br/><br/><p>Answer all mini quiz on your chosen floor to collect more points!</p><p>Choose your floor to maximize your escape experience</p><select id="floor-sel" name="floor-sel" class="custom-select floor-sel" placeholder="Choose Floor"><option selected value="32">Floor 32</option><option selected value="33">Floor 33</option><option value="34">Floor 34</option><option selected value="35">Floor 35</option><option selected value="36">Floor 36</option><option value="37">Floor 37</option></select><br /><br /><p><a href="javascript:void(0);" onclick="$.letsGo(this)" class="btn btn-red font-size-18">START NOW</a></p></div>'
    ),
    showPopup()
  // setTimeout(customSelect, 50)
}
function selectBuilding() {
  closeIntro(), closeHelp(), showPopup()
  // setTimeout(customSelect, 50)
}
function customSelect() {
  $(".custom-select").each(function () {
    var e = $(this).attr("class"),
      t = ($(this).attr("id"), $(this).attr("name"), '<div class="' + e + '">')
    ;(t +=
      '<span class="custom-select-trigger">' +
      $(this).attr("placeholder") +
      "</span>"),
      (t += '<div class="custom-options">'),
      $(this)
        .find("option")
        .each(function () {
          t +=
            '<span class="custom-option ' +
            $(this).attr("class") +
            '" data-value="' +
            $(this).attr("value") +
            '">' +
            $(this).html() +
            "</span>"
        }),
      (t += "</div></div>"),
      $(this).wrap('<div class="custom-select-wrapper"></div>'),
      $(this).hide(),
      $(this).after(t)
  }),
    $(".custom-option:first-of-type").hover(
      function () {
        $(this).parents(".custom-options").addClass("option-hover")
      },
      function () {
        $(this).parents(".custom-options").removeClass("option-hover")
      }
    ),
    $(".custom-select-trigger").on("click", function (e) {
      $("html").one("click", function () {
        $(".custom-select").removeClass("opened")
      }),
        $(this).parents(".custom-select").toggleClass("opened"),
        e.stopPropagation()
    }),
    $(".custom-option").on("click", function () {
      console.log(
        $(this).parents(".custom-select-wrapper").find("select").val()
      ),
        $(this)
          .parents(".custom-select-wrapper")
          .find("select")
          .val($(this).data("value")),
        $(this)
          .parents(".custom-options")
          .find(".custom-option")
          .removeClass("selection"),
        $(this).addClass("selection"),
        $(this).parents(".custom-select").removeClass("opened"),
        $(this)
          .parents(".custom-select")
          .find(".custom-select-trigger")
          .text($(this).text())
          .addClass("active")
    })
}
var API_URL = "http://dbsapi.staging2.salt.co.id/api/"
!(function (e) {
  e(".aboutus-page").length > 0 &&
    e(".aboutus-page")
      .slick({
        infinite: !1,
        vertical: !0,
        adaptiveHeight: !0,
        dots: !1,
        arrows: !1,
      })
      .mousewheel(function (t) {
        t.preventDefault(),
          t.deltaY < 0 ? e(this).slick("slickNext") : e(this).slick("slickPrev")
      }),
    e(".floor-warden-slide").length > 0 &&
      e(".floor-warden-slide").slick({
        infinite: !1,
        dots: false,
        arrows: !0,
        adaptiveHeight: !0,
        customPaging: function (t, n) {
          console.log(e(t.$slides[n]))
          var i = e(t.$slides[n]).attr("data-floor"),
            o = "<strong>" + i + "<span>TH</span></strong>"
          return o
        },
      }),
    e(".scrollbar").length > 0 &&
      e(window).on("load", function () {
        e(".scrollbar").mCustomScrollbar({ snapOffset: 100 })
      })
})(jQuery),
  (function (e) {
    e(document).on("change", ".answer-item input[name='answer']", function () {
      var t = e(this).parents("li").index()
      e(".ans-opt li").removeClass("active"),
        e(".ans-opt li").eq(t).addClass("active")
    }),
      e(document).on("click", ".custom-option", function () {
        e(".random-floor").removeClass("active"),
          (_floor = e(this)
            .parents(".custom-select-wrapper")
            .find("select")
            .val())
      }),
      e(document).on("click", ".random-floor", function () {
        e(this).addClass("active"),
          e(".custom-select-trigger").removeClass("active"),
          (_floor = 0)
      })
  })(jQuery)

$(".part-location").on("click", function () {
  $(".part-location").removeClass("location-active")

  $(this).addClass(" location-active")
})
var placed = "ciputra"
function chooseLocation(place) {
  placed = place
  setTourLocation()
}

function setTourLocation() {
  if (placed == "ciputra") {
    $("#next-location").prop("href", "tour.html")
  } else if (placed == "juanda") {
    $("#next-location").prop("href", "tour-juanda.html")
  } else if (placed == "capital") {
    $("#next-location").prop("href", "tour-capital.html")
  }
}

setTourLocation()
